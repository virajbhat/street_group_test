# street_group_test
This repository aims to fulfil the task provided by street group company for data engineer position which icludes but not limited to the demonstration of the use of Apache - beam using python sdk to handle property transactions data. Direct runner is used to run the pipeline.

<h3> Input </h3>

The input data is taken from http://prod.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-2021.csv It is written in varible input_file_yearly in property_transactions.py to make it easy to run the pipeline directly from IDE instead of Providing commandline arguments since that was the dataset which was Supposed to be considered.

The data needs to be placed in input_files folder in the current working directory. The folder is created by the code and it also checks for input file. If file is not present code with exit with exit code 1.


<h3> Transforms </h3>

All transforms are performed using a single composite transform - The data is first split and appropriate field names are added as referenced from https://www.gov.uk/guidance/about-the-price-paid-data#download-option

<h4> Unique Key </h4>
A unique key is generated by concatinating values of columns: post_code, PAON, SAON, locality, Town, district and county to ensure that every key remains unique for that perticular property. If property is duplicated then property_ID will also be duplicated as the id is associated with property. This done for further grouping task.


<h3> Output </h3>

Output will be generated and can be found in output_files folder in current working directory. The folder is automatically created by the code and user need not create it manually. 

<h4>output format<h4>
 
The output format is as follows:
  
output template- {Property_ID:<property_details>,Transaction_Details:[<transactions>]}
  
Example 1. Properties having single transaction -
  
{'Property_ID': 'B691QQ_150__TIVIDALE_OLDBURY_SANDWELL_WESTMIDLANDS', 'Transaction_Details': [{'Transaction_id': '{D707E536-3C15-0AD9-E053-6B04A8C067CC}', 'price_paid': '415000', 'Transfer_date': '2021-07-16 00:00', 'post_code': 'B69 1QQ', 'property_type': 'D', 'old_or_new': 'N', 'duration': 'F', 'PAON': '150', 'SAON': '', 'street': 'OAKHAM ROAD', 'locality': 'TIVIDALE', 'Town': 'OLDBURY', 'district': 'SANDWELL', 'county': 'WEST MIDLANDS', 'ppd_cat_type': 'A', 'record_status': 'A'}]}

  
Example 2. Properties having more than one transaction - 
  
{'Property_ID': 'LS134AE_1__BRAMLEY_LEEDS_LEEDS_WESTYORKSHIRE', 'Transaction_Details': [{'Transaction_id': '{D707E536-5C1A-0AD9-E053-6B04A8C067CC}', 'price_paid': '223000', 'Transfer_date': '2021-12-20 00:00', 'post_code': 'LS13 4AE', 'property_type': 'T', 'old_or_new': 'N', 'duration': 'F', 'PAON': '1', 'SAON': '', 'street': 'SOMERDALE MEWS', 'locality': 'BRAMLEY', 'Town': 'LEEDS', 'district': 'LEEDS', 'county': 'WEST YORKSHIRE', 'ppd_cat_type': 'A', 'record_status': 'A'}, {'Transaction_id': '{D707E536-5C1B-0AD9-E053-6B04A8C067CC}', 'price_paid': '223000', 'Transfer_date': '2021-12-20 00:00', 'post_code': 'LS13 4AE', 'property_type': 'T', 'old_or_new': 'N', 'duration': 'F', 'PAON': '1', 'SAON': '', 'street': 'SOMERDALE MEWS', 'locality': 'BRAMLEY', 'Town': 'LEEDS', 'district': 'LEEDS', 'county': 'WEST YORKSHIRE', 'ppd_cat_type': 'A', 'record_status': 'A'}]}
  



<h3> Unit Test </h3>
  
Unit tests are written in test_property_transactions.py. Since the whole composite transform is tested, all transforms also get tested within it.


<h3> Running the pipeline </h3>

Code can directly be run using run button in the IDE
  
Steps for commandline:

Navigate to src folder
Run unittest: `python -m unittest discover`
Run transactions.py from IDE or enter command: `python property_transactions.py`
Run both together: `python -m unittest discover && python property_transactions.py`
Check output in output folder in project directory. (results-00000-of-00001.jsonl)
Output format is newline delimited json file. (jsonl)
 
